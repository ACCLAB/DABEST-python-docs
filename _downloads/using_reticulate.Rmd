---
title: "Using DABEST in R via the reticulate package"
author: "Joses Ho"
---

# Data Munging in R

For this demonstration, we will load the `CO2` dataset found in the `datasets` package that is bundled with R. This dataset is described in the [official documentation](https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/zCO2.html) as
:

*"The CO~2~ uptake of six plants from Quebec and six plants from Mississippi was measured at six levels of ambient CO~2~ concentration. Half the plants of each type were chilled overnight before the experiment was conducted."*

```{r load_libraries, results='hold'}
library(datasets)
head(CO2)
```

```{r summary}
summary(CO2)
```

# Munge and plot the data using R packages.

For this demonstration, we select readings taken at a CO~2~ concentration of 1000 mL/L.

```{r plot_ggplot, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)

df = filter(CO2, conc == '1000')

ggplot(df, aes(x = Type, 
               y = uptake, 
               color = Treatment)) + 
  geom_point() + 
  ggtitle('CO2 conc = 1000 mL/L') + 
  xlab('City') + ylab('CO2 uptake')
```


# Switch to Python and use `DABEST`.

First, we load the package `reticulate`.

```{r load_reticulate, message=FALSE, warning=FALSE}
library(reticulate)
# If you are using Anaconda, or are dealing with virtual environments, you will need to specify the location of the specific Python environment you are using.
use_python('/Users/whho/anaconda3/bin/python')
```


The following chunk of code is in Python. To access the R dataframe , we use the `r` object, which `reticulate` creates for the Python kernel. We will use Python's `.` operator to access the R dataframe `df` above.

```{python make_dabest_plot, dpi=250}
import matplotlib.pyplot as plt
import dabest

f1, results = dabest.plot(data=r.df, fig_size=(5,7),
                         x='Type', y='uptake', 
                         swarm_label='CO2 uptake',
                         color_col='Treatment',
                         idx=['Quebec', 'Mississippi']
                         )
                   
f1.savefig('dabest-plot-CO2.png', bbox_inches='tight')
```

![](/Users/whho/git-repos/jupyter_base/DABEST/reticulate/dabest-plot-CO2.png)

We can also take a look at the statistics from R. Simply use the `py` object; use the `$` operator to access named variables.

```{r check_stats}
py$results
```

Because `results` is a Python `pandas` object, `py$results` is an R `data.frame`; its attributes can be accessed easily via the `$` operator.

```{r print_nice_results}
py_results = py$results
mean_diff = py_results$stat_summary
ci_low = py_results$bca_ci_low
ci_high = py_results$bca_ci_high

# Print results, with all numerical values formatted to 2 decimal places.
sprintf("Mean Difference = %.2f [95CI %.2f, %.2f]", 
        mean_diff, ci_low, ci_high)
```